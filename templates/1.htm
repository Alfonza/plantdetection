
<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="
    ../static/style2.css">
</head>
<body>
    <div class="logo">
        <img class="immg" src="../static/prologo.png">
    </div>
    <div id="panel">
        <div class="toggle-btn" onclick="togglepanel()">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul>
            <li onclick="window.location.href='explore.html'">Explore</li>
            <li>Contact</li>
            <li>About</li>
            <li id="recent" onclick="window.location.href='recent.html'">Recent</li>
        </ul>
    </div> 
    <div class="wrapper">
        <div class="btn">
            <button id="login">Login</button>
        </div>
    </div>

    <div class="header-search-box" >
        <form id="upload-file" action="/web/item/upload_flower_to_save" method="post" enctype="multipart/form-data">
            <input id='search' class="search-input" autocomplete="off" type="text" name="word" placeholder="Upload picture or search by the name">
            <span class="center-line"></span>
            <div class="search-icon">
                <input id="header-page" style="display: none" name="page">
                <input id="header-region" style="display: none" name="region">
                <div class="image-upload">
                   <input id="file-input" type="file" name="img" oninput="showpic(this)" accept="image/*" / >
               </div>
               <label for="file-input"  class="label-search-icon-1">
                <img onclick="showpic(this)" src="https://static.picturethisai.com/production/icons/web/icon_photo.png">
            </label>
            <label class="label-search-icon-2">
                <input id="searchbtn" class="header-search-icon-2" type="button" onclick="searchstring()">
                <img src="https://static.picturethisai.com/production/icons/web/icon_search.png">
            </label>
        </div>
    </form>
<div class="now" style="display: none">
 <div id="canvas">
  <img id="pic" >
  <button onclick="$('#canvas').hide();">Try Another!</button>
  <button onclick="send()">Continue</button>
</div>
</div>
<footer>
    <p>
        Created by rimold,sarath,alphonsa,ashwin
    </p>
</footer>
    <div id="modelbox" style="background-color: #5f5e5e87;position: fixed;top:0px;left:0px;height: 100%;width: 100%;display: block" onclick="document.getElementById('modelbox').style.display='none'">
        <div id="box" onclick="none" >

            <img id="error" src="../static/error.png">
            <label id="msg">oops! search not found!
            </label>
            <div id="suggestions">

        </div>

    <button id='tryagain' onclick="document.getElementById('modelbox').style.display='none'">Try another</button>
    </div>
</div>
<style type="text/css">
    #box{
        background-color: white;position: fixed;top:10%;left:10%;height: 80%;width: 80%;display: inherit;
        text-align: center;
    }
    @media (min-width: 1000px) {
       #error{
        height: 150px;
        width: 150px;
        margin-left: 15%;
        margin-top: 5%; 
       }
   }
   @media (max-width: 1000px) {
       #error{
        margin-top: 5%; 

        height: 500px;
        width: 500px;
        top: 10%;
       }

       #msg{
        position: absolute;
        top: 46%;
        left: 20%;
        color: red;
        font-size: 40px;
       }
       #tryagain{
    position: relative;
    z-index: 2;
    height: 103px;
    top: 40%;
    left: 24%;
    width: 50%;
    background-color: red;
    border: none;
    font-size: 48px;
    font-weight: 00;
       }
       .member{
               background-color: #ddfffd;
    /* position: relative; */
    width: 125%;
    height: 4%;
    /* padding: 8px; */
    color: #018390;
    position: absolute;
    left: -10px;
    font-size: 195%;
    padding: 46px;
    margin-bottom: 57px;
    padding-top: 22px;
}       }
       #suggestions{
        position: absolute;
    top: 55%;
    left: 30%;
    height: 30%;
    width:25%;
}
       }
   }
</style>
<script src='../static/jquery.js'></script>
<script type="text/javascript">
    
    var ip= 'http://localhost:8050';
    console.log(localStorage.getItem('name'));
    
    if(localStorage.getItem('name')==null){
       document.getElementById('login').onclick=function(){window.location.href="new12.htm"};
       
       document.getElementById('recent').style.display="none";
   }
   else{
    $("#login").text(localStorage.getItem('name').replace(/"/g,""));
         //show recent
         document.getElementById('login').onclick=function(){
             val=confirm('are you sure to log out?');
             if(val){
                localStorage.removeItem('name');
                localStorage.removeItem('email');
                location.reload();    
            }
        }
    }
    
    function suggest(keyword)
    {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() 
        {
          if (this.readyState == 4 && this.status == 200) 
          {
            suggestbox=document.getElementById('box');
            suggestbox.innerHTML = 'oops. search not found';
            if(this.responseText!="none")
            {
                
            }
        }
        else if(this.readyState==4 && this.status==0)
        {
            alert("connection error!");
        }
    }
    xhttp.open("GET", ip+'/suggest?query='+keyword, true);
    xhttp.send();
}
    function togglepanel() {
        document.getElementById("panel").classList.toggle('active');
    } 
    function searchstring(){
        search = document.getElementById('search').value;
        if(search==""){
            alert("please enter keyword to search");
            return;
        }
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            if(this.responseText.slice(0,4)=="none"){
                console.log(this.responseText);
                string=this.responseText.slice(4,this.responseText.length);
                suggestions=string.split(',');
                document.getElementById('msg').innerHTML=document.getElementById('msg').innerHTML+"<br> Did you mean"
                for(i=1;i<3;i++)
                {
                    suggestbox=document.getElementById('suggestions');
                    document.getElementById('modelbox').style.display="block";
                    label=document.createElement('label');
                    label.innerHTML=suggestions[i];
                    label.setAttribute('class','member');
                    label.onclick=function()
                    {
                        document.getElementById('search').value=label.innerHTML;
                    searchstring();
                    }

                    label.style.top=(i-1)*25+"%";
                    suggestbox.appendChild(label);
                    suggestbox.innerHTML=suggestbox.innerHTML+"<br>";

                }
            }
            else if(this.responseText.slice(0,3)!="nil"){
              localStorage.setItem('data',this.responseText);
              window.location.href="rosenew.html";
              }
          }
          else if(this.readyState==4 && this.status==0){
            alert("connection error!");
        }
    }
    xhttp.open("GET", ip+'/classify?flowername='+search, true);
    xhttp.send();
}
function showpic(input){
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#pic')
            .attr('src', e.target.result);

            $('#canvas').show();
        };

        reader.readAsDataURL(input.files[0]);
    }
}
function togglepanel() {
    document.getElementById("panel").classList.toggle('active');
} 
function showpic(input){
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#pic')
            .attr('src', e.target.result);

            $('#canvas').show();
        };

        reader.readAsDataURL(input.files[0]);
    }
}
function send() {
    var form = document.getElementById('file-input');   
    var file = form.files[0];
    var data = new FormData();
    data.append('img', file);
    console.log(data);
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            alert(this.responseText);
        }
    };
    xhr.open('POST' , ip+'/classify', true);
    xhr.send(data);
    
}
var input = document.getElementById("search");

// Execute a function when the user releases a key on the keyboard
input.addEventListener("keyup", function(event) {
  // Number 13 is the "Enter" key on the keyboard
  if (event.keyCode === 13) {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    document.getElementById('searchbtn').click();
}
});
</script>
</body>
</html>
